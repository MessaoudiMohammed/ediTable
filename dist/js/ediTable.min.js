!function(c){"use strict";c.fn.ediTable=function(a){var b=[],a=c.extend(!0,{editable:!0,json:{head:[],body:[]},button:{edit:{active:!1,text:"edit",selector:"edit"},delete:{active:!1,text:"delete",selector:"delete"},title:"Actions"},add:!1,keyboard:!0,beforeSave:function(){},afterSave:function(){},beforeEdit:function(){},afterEdit:function(){},beforeDelete:function(){},afterDelete:function(){}},a),d=["edit","delete","title"],e=function(b){a.editable&&(c(b).on("dblclick","tbody>tr",h),b.children("tbody").children("tr").addClass("editable-row-style")),a.button&&(a.button.edit.active&&c("."+a.button.edit.selector,b).bind("click",h),a.button.delete.active&&c("."+a.button.delete.selector,b).bind("click",n),c.each(a.button,function(a,f){if(!d.includes(a)){if(null==f.action||""==f.action||null==f.action)return console.error("you missed action function of button."+a+" object in options E.G \"{\n\tbutton.costumButton:{\n\t\taction:\"function($row){HELLO}\" \n\t}\n}\"!");if(null!=f.selector)c("."+f.selector,b).bind("click",function(a){f.action(o(c(a.currentTarget).parents("tr")),c(a.currentTarget).parents("tr"))});else return console.error("you missed selector property of button."+a+" object in options E.G \"{\n\tbutton.costumButton:{\n\t\tselector:\".costumButton\" \n\t}\n}\"!")}})),a.sortable&&(b.children("thead").children("tr").children("th").click(function(){var a=c(this).parents("table").eq(0),b=a.find("tr:gt(0)").toArray().sort(f(c(this).index()));this.asc=!this.asc,this.asc||(b=b.reverse());for(var d=0;d<b.length;d++)a.append(b[d])}),b.children("thead").children("tr").children("th").addClass("sortable"))},f=function(d){function e(a,b){return c(a).children("td").eq(b).text()}return function(f,a){var b=e(f,d),g=e(a,d);return c.isNumeric(b)&&c.isNumeric(g)?b-g:b.toString().localeCompare(g)}},g=!1,h=function(a){a.stopPropagation();var b=null;b="TR"===c(a.currentTarget).prop("tagName")?c(a.currentTarget):c(a.currentTarget).parents("tr"),0<b.find(".editable-input").length?j(b):l(b)},i=function(d){var e="";g&&(e=`:not(:last-child)`),c("td"+e,d).each(function(e,f){var g=!0;null!=a.json.head&&0<a.json.head.length&&(("select"==a.json.head[e].type||"checkbox"==a.json.head[e].type)&&(c(f).attr("data-value",b[d.prevAll().length][e].value),c(f).html(b[d.prevAll().length][e].label),g=!1),"color"==a.json.head[e].type&&(c(f).attr("data-value",b[d.prevAll().length][e].value),c(f).css("background-color",b[d.prevAll().length][e].value),c(f).html(""),g=!1),"image"==a.json.head[e].type&&(g=!1)),g&&c(f).html(b[d.prevAll().length][e].value)}),c.each(a.button,function(){this.active&&null!=this.text&&c("."+this.selector,d).html(this.text)})},j=function(d){a.beforeSave(o(d),d);var e="";g&&(e=`:not(:last-child)`);var f=[],h=[],i=[];return d.children(`td${e}`).each(function(b,e){if(!1!=a.json.head[b].editable){if(0==c(".editable-input:input",c(e)).length)return;!1!=a.json.head[b].validation&&!1==c(".editable-input:input",c(e))[0].checkValidity()&&(h.push({input:c(".editable-input:input",c(e)),row:d.prevAll().length,column:b}),c(".editable-input:input",c(e)).addClass("error")),!1!=a.json.head[b].required&&"checkbox"!=a.json.head[b].type&&(""==c(".editable-input:input",c(e)).val()||null==c(".editable-input:input",c(e)).val()||null==c(".editable-input:input",c(e)).val())&&(f.push({input:c(".editable-input:input",c(e)),row:d.prevAll().length,column:b}),c(".editable-input:input",c(e)).addClass("error"))}}),0<f.length?void(a.requiredAction?a.requiredAction(f):alert(`Fields required.`)):0<h.length?void(a.invalidAction?a.invalidAction(h):alert(`Fields invalid.`)):void(d.children(`td${e}`).each(function(b,d){var e=!0,f=!1;if(0<a.json.head.length){if("color"==a.json.head[b].type&&(e=!1,!1==a.json.head[b].editable?f=!0:i.push(c(".editable-input:input",c(d)).val()),c(d).attr("data-value",c(".editable-input:input",c(d)).val()),c(d).css({"background-color":c(".editable-input:input",c(d)).val()}),c(d).html("")),"checkbox"==a.json.head[b].type){if(null==a.json.head[b].checked||null==a.json.head[b].unchecked)return console.error("you missed checked/unchecked property of checkbox!");var g="",h=a.json.head[b].checked,j=a.json.head[b].unchecked;!c(".editable-input:input",c(d)).is(":checked")||(g=" checked"),c(".editable-input:input",c(d)).is(":checked")&&(j=a.json.head[b].checked),null!=a.json.head[b].label&&(h=a.json.head[b].label(j)),c(d).attr("data-value",j),c(d).html(h),e=!1,!1==a.json.head[b].editable?f=!0:i.push({label:h,value:j})}if(null!=a.json.head[b].data){var k=a.json.head[b].data.filter(function(b){return b.value==c(".editable-input:input",c(d)).val()});c(d).attr("data-value",k[0].value),c(d).html(k[0].label),e=!1,!1==a.json.head[b].editable?f=!0:i.push({label:k[0].label,value:k[0].value})}"image"==a.json.head[b].type&&(e=!1,!1==a.json.head[b].editable?f=!0:i.push({value:c(d).find("img").attr("src")}))}e&&(!1==a.json.head[b].editable?f=!0:i.push(c(".editable-input:input",c(d)).val()),c(d).html(c(".editable-input:input",c(d)).val())),f&&i.push(c(d).text())}),c.each(a.button,function(){this.active&&null!=this.text&&c("."+this.selector,d).html(this.text)}),a.afterSave(i,b[d.prevAll().length],d))},k=function(a){var b="",d=c(a.clone());g&&(b=`:not(:last-child)`),d.children(`td${b}`).html(""),d.children(`td${b}`).attr("data-value",""),d.children(`td${b}`).removeAttr("style"),a.is("tr:last")&&a.parent().append(d)},l=function(d){a.beforeEdit(o(d),d),!a.add||k(d);c.each(a.button,function(){this.active&&null!=this.textActive&&c("."+this.selector,d).html(this.textActive)});var e="";d.children(`td${""}`).each(function(f,h){if(!(g&&c(h).is(":last-child"))){if(null==a.json.head[f]&&(a.json.head[f]=[]),null==a.json.head[f].type&&(a.json.head[f].type="text"),null==b[d.prevAll().length]&&(b[d.prevAll().length]=[]),b[d.prevAll().length][f]={value:c(h).text()},("select"==a.json.head[f].type||"color"==a.json.head[f].type||"checkbox"==a.json.head[f].type)&&(b[d.prevAll().length][f]={label:c(h).text(),value:c(h).attr("data-value")}),"image"==a.json.head[f].type)return void(b[d.prevAll().length][f]={value:c(h).children("img").attr("src")});if(!1!=a.json.head[f].editable){e="<input style=\"width:"+c(h).width()+"px\" type=";var i="class=\"editable-input\"",j="value=\""+b[d.prevAll().length][f].value+"\"";if(null!=a.json.head[f].classes&&(i="class=\""+a.json.head[f].classes+" editable-input\" "),"checkbox"==a.json.head[f].type){var k=c(h).attr("data-value");if(null==a.json.head[f].checked||null==a.json.head[f].unchecked)return console.error("you missed checked/unchecked property for checkbox column!");"boolean"==typeof a.json.head[f].checked&&(k=c.parseJSON(c(h).attr("data-value"))),e+=`"${a.json.head[f].type}" ${i} ${k==a.json.head[f].checked&&"checked"} />`}else if("select"==a.json.head[f].type)e=`<select ${i}>`,c.each(a.json.head[f].data,function(a,b){var d="";c(h).attr("data-value")==b.value&&(d="selected"),e+=`<option value="${b.value}" ${d} >${b.label}</option>`}),e+="</select>";else{var l="",n="";"number"==a.json.head[f].type&&(null!=a.json.head[f].min&&(l="min=\""+a.json.head[f].min+"\""),null!=a.json.head[f].max&&(n="max=\""+a.json.head[f].max+"\"")),e+=`"${a.json.head[f].type}" ${i} ${l} ${n} ${j} />`}c(h).html(e),c(".editable-input:input",c(h)).unbind("dblclick"),c(".editable-input:input",c(h)).bind("dblclick",function(a){a.stopPropagation()}),a.keyboard&&c(".editable-input:input",c(h)).on("keydown",function(a){m(a,d)}),!1!=a.json.head[f].validation&&c(":input",d.children(`:nth-child(${f+1})`)).blur(function(a){a.target.checkValidity()?c(a.target).removeClass("error"):c(a.target).addClass("error")})}}}),a.afterEdit(b[d.prevAll().length],d)},m=function(a,b){13===a.which?j(b):27===a.which&&i(b)},n=function(b){var d=c(b.currentTarget).parents("tr");a.beforeDelete(o(d),d),d.remove(),a.afterDelete(o(d),d)},o=function(b){var d=[],e="";g&&(e=":not(:last-child)"),c(b.children(e)).each(function(b,e){var f=!0;a.json.head.length&&c(e).find(".editable-input:input").length&&("checkbox"==a.json.head[b].type&&(d.push(c(e).find(".editable-input:input").is(":checked")),f=!1),"image"==a.json.head[b].type&&(d.push(c(e).find("img").attr("src")),f=!1)),f&&(c(e).find(".editable-input:input").length?d.push(c(e).find(".editable-input:input").val()):d.push(c(e).text()))})},p=function(b){if("TABLE"!==b.prop("tagName"))return console.warm("Make sure that you're selecting <table> element!");if(void 0===a.button.edit.selector)return console.error("you missed selector property of button.edit object in options E.G \"{\n\tbutton.edit:{\n\t\tshow:true/false\n\t}\n}\"!");if(void 0===a.button.edit.active)return console.error("you missed show property of button.edit object in options E.G \"{\n\tbutton.edit:{\n\t\tshow:true/false\n\t}\n}\"!");var d=`<thead>`;d+=`<tr>`;var f=0;if(c.each(a.json.body[0],function(b){d+=a.json.head.length&&null!=a.json.head[f].title?`<th>${a.json.head[f].title}</th>`:`<th>${b}</th>`,f++}),d+=`</tr>`,d+=`</thead>`,b.prepend(d),null!=a.json.body&&0<a.json.body.length){var d=`<tbody>`;null==a.json.head&&(a.json.head={}),c.each(a.json.body,function(b,e){d+=`<tr>`;var f=0;c.each(e,function(b,e){var g=!0;if(0<a.json.head.length){if("color"==a.json.head[f].type&&(d+=`<td class="${b}" data-value="${e}" style="background-color:${e}"></td>`,g=!1),"select"==a.json.head[f].type&&null!=a.json.head[f].data){var h=a.json.head[f].data.filter(function(b){return b.value==e});if(!h.length)return console.error("make sure that your data is correct!");d+=`<td class="${b}" data-value="${h[0].value}" >${h[0].label}</td>`,g=!1}if("image"==a.json.head[f].type&&(d+=`<td class="${b}" ><img src="${e}"/></td>`,g=!1),"checkbox"==a.json.head[f].type){var i=a.json.head[f].unchecked,j=e;if(null==a.json.head[f].checked||null==a.json.head[f].unchecked)return console.error("you missed checked/unchecked property for checkbox column!");"boolean"==typeof a.json.head[f].checked&&c.parseJSON(e),a.json.head[f].checked==e&&(i=a.json.head[f].checked),null!=a.json.head[f].label&&(j=a.json.head[f].label(i)),d+=`<td class="${b}" data-value="${i}" >${j}</td>`,g=!1}}g&&(d+=`<td class="${b}" >${e}</td>`),f++}),d+=`</tr>`}),d+=`</tbody>`,b.append(d)}a.editable&&(c.each(b.children("tbody").children("tr"),function(b,d){var e="<td>";c.each(a.button,function(){this.active&&(e+=`<span class="${this.selector}" >${this.text}</span>`,g=!0)}),g&&c(d).append(e+"</td>")}),g&&b.children("thead").children("tr:first-child").append(`<th rowspan="${b.children("thead").children("tr").length}">${a.button.title}</th>`)),e(b),b.find("thead tr").length||console.warn("table without heads!"),b.find("tbody tr").length||console.warn("Empty table!")};return this.each(function(){p(c(this))}),{elememt:this,options:a}}}($);