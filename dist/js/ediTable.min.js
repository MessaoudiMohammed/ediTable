!function(v){"use strict";v.fn.ediTable=function(u){var s=[],t=[],l=(u=v.extend(!0,{editable:!0,json:{head:[],body:[]},button:{edit:{active:!1,text:"edit",selector:"edit"},delete:{active:!1,text:"delete",selector:"delete"},title:"Actions"},add:!1,keyboard:!0,beforeSave:function(){},afterSave:function(){},beforeEdit:function(){},afterEdit:function(){},beforeDelete:function(){},afterDelete:function(){},beforeAdd:function(){},afterAdd:function(){},beforeAppend:function(){}},u),["edit","delete","title"]),i=function(l){function i(e,t){return v(e).children("td").eq(t).text()}return function(e,t){var n=i(e,l),a=i(t,l);return v.isNumeric(n)&&v.isNumeric(a)?n-a:n.toString().localeCompare(a)}},p=!1,d=function(e){e.stopPropagation();var t=null;0<(t="TR"===v(e.currentTarget).prop("tagName")?v(e.currentTarget):v(e.currentTarget).parents("tr")).find(".editable-input").length?o(t):n(t)},o=function(n){u.beforeSave(s[n.prevAll().length],n);var e="",o=0,r="";p&&(e=":not(:last-child)");var a=[],l=[],c={};n.children("td"+e).each(function(e,t){if(0!=u.json.head[e].editable){if(0==v(".editable-input:input",v(t)).length)return;0!=u.json.head[e].validation&&0==v(".editable-input:input",v(t))[0].checkValidity()&&(l.push({input:v(".editable-input:input",v(t)),row:n.prevAll().length,column:e}),v(".editable-input:input",v(t)).addClass("error")),0!=u.json.head[e].required&&"checkbox"!=u.json.head[e].type&&(""!=v(".editable-input:input",v(t)).val()&&null!=v(".editable-input:input",v(t)).val()&&null!=v(".editable-input:input",v(t)).val()||(a.push({input:v(".editable-input:input",v(t)),row:n.prevAll().length,column:e}),v(".editable-input:input",v(t)).addClass("error")))}}),0<a.length?u.requiredAction?u.requiredAction(a):alert("Fields required."):0<l.length?u.invalidAction?u.invalidAction(l):alert("Fields invalid."):(n.children("td"+e).each(function(e,t){var n=!0,a=!1;if(r=null!=v(t).attr("data-index")?v(t).attr("data-index"):o,0<u.json.head.length){if("color"==u.json.head[e].type&&(n=!1,0==u.json.head[e].editable?a=!0:c[r]=v(".editable-input:input",v(t)).val(),v(t).attr("data-value",v(".editable-input:input",v(t)).val()),v(t).css({"background-color":v(".editable-input:input",v(t)).val()}),v(t).html("")),"checkbox"==u.json.head[e].type){if(null==u.json.head[e].checked||null==u.json.head[e].unchecked)return console.error("you missed checked/unchecked property of checkbox!");var l=u.json.head[e].checked,i=u.json.head[e].unchecked;v(".editable-input:input",v(t)).is(":checked")&&" checked",v(".editable-input:input",v(t)).is(":checked")&&(i=u.json.head[e].checked),null!=u.json.head[e].label&&(l=u.json.head[e].label(i)),v(t).attr("data-value",i),v(t).html(l),n=!1,0!=u.json.head[e].editable?c[r]=i:a=!0}if(null!=u.json.head[e].data){var d=u.json.head[e].data.filter(function(e){return e.value==v(".editable-input:input",v(t)).val()});v(t).attr("data-value",d[0].value),v(t).html(d[0].label),n=!1,0!=u.json.head[e].editable?c[r]=d[0].value:a=!0}"image"==u.json.head[e].type&&(n=!1,0!=u.json.head[e].editable?c[r]=v(t).find("img").attr("src"):a=!0)}n&&(0!=u.json.head[e].editable?c[r]=v(".editable-input:input",v(t)).val():a=!0,v(t).html(v(".editable-input:input",v(t)).val())),a&&(c[r]=v(t).text()),o++}),v.each(u.button,function(){this.active&&null!=this.text&&v("."+this.selector,n).html(this.text)}),u.afterSave(c,s[n.prevAll().length],n))},n=function(o){var e=u.beforeEdit(f(o),o);if(null!=e&&null!=e.options&&v.extend(!0,u,e.options),u.add&&function(e){u.beforeAdd();var t="",n=v(e.clone());p&&(t=":not(:last-child)"),n.children("td"+t).html(""),n.children("td"+t).attr("data-value",""),n.children("td"+t).removeAttr("style"),v(e,e.parent()).is("tr:last-child")&&e.parent().append(n),u.afterAdd(v(n,e))}(o),u.editable){v.each(u.button,function(){this.active&&null!=this.textActive&&v("."+this.selector,o).html(this.textActive)});var r,c="",h=0;o.children("td").each(function(e,a){if(!p||!v(a).is(":last-child")){if(r=null!=v(a).attr("data-index")&&""!=v(a).attr("data-index")?v(a).attr("data-index"):h,h++,null==u.json.head[e]&&(u.json.head[e]=[]),null==u.json.head[e].type&&(u.json.head[e].type="text"),null==s[o.prevAll().length]&&(s[o.prevAll().length]={}),s[o.prevAll().length][r]=v(a).text(),"select"!=u.json.head[e].type&&"color"!=u.json.head[e].type&&"checkbox"!=u.json.head[e].type||(s[o.prevAll().length][r]=v(a).attr("data-value")),"image"==u.json.head[e].type)return s[o.prevAll().length][r]=v(a).children("img").attr("src");if(0!=u.json.head[e].editable){c="<input type=";var t=' class="editable-input"',n=' value="'+s[o.prevAll().length][r]+'"';if(null!=u.json.head[e].classes&&(t='class="'+u.json.head[e].classes+' editable-input" '),"checkbox"==u.json.head[e].type){var l=v(a).attr("data-value");if(null==u.json.head[e].checked||null==u.json.head[e].unchecked)return console.error("you missed checked/unchecked property for checkbox column!");"boolean"==typeof u.json.head[e].checked&&(l=v.parseJSON(v(a).attr("data-value"))),c+='"'+u.json.head[e].type+'"'+t+(l==u.json.head[e].checked?" checked":"")+"/>"}else if("select"==u.json.head[e].type)c="<select "+t+'><option value="">choose option</option>',v.each(u.json.head[e].data,function(e,t){var n="";v(a).attr("data-value")==t.value&&(n="selected"),c+='<option value="'+t.value+'" '+n+">"+t.label+"</option>"}),c+="</select>";else{var i="",d="";"number"==u.json.head[e].type&&(null!=u.json.head[e].min&&(i='min="'+u.json.head[e].min+'"'),null!=u.json.head[e].max&&(d='max="'+u.json.head[e].max+'"')),c+='"'+u.json.head[e].type+'"'+t+i+d+n+"/>"}v(a).html(c),v(".editable-input:input",v(a)).unbind("dblclick"),v(".editable-input:input",v(a)).bind("dblclick",function(e){e.stopPropagation()}),u.keyboard&&v(".editable-input:input",v(a)).on("keydown",function(e){b(e,o)}),0!=u.json.head[e].validation&&v(":input",o.children(":nth-child("+e+"1)")).blur(function(e){e.target.checkValidity()?v(e.target).removeClass("error"):v(e.target).addClass("error")})}}})}u.afterEdit(s[o.prevAll().length],o)},b=function(e,t){var a,n;13===e.which?o(t):27===e.which&&(n="",p&&(n=":not(:last-child)"),v("td"+n,a=t).each(function(e,t){var n=!0;null!=u.json.head&&0<u.json.head.length&&("select"!=u.json.head[e].type&&"checkbox"!=u.json.head[e].type||(v(t).attr("data-value",s[a.prevAll().length][v(t).attr("data-index")]),v(t).html(u.json.head[e].label(s[a.prevAll().length][v(t).attr("data-index")])),n=!1),"color"==u.json.head[e].type&&(v(t).attr("data-value",s[a.prevAll().length][v(t).attr("data-index")]),v(t).css("background-color",s[a.prevAll().length][v(t).attr("data-index")]),v(t).html(""),n=!1),"image"==u.json.head[e].type&&(n=!1)),n&&v(t).html(s[a.prevAll().length][v(t).attr("data-index")])}),v.each(u.button,function(){this.active&&null!=this.text&&v("."+this.selector,a).html(this.text)}))},r=function(e){var t=v(e.currentTarget).parents("tr");u.beforeDelete(f(t),t),t.remove(),u.afterDelete(f(t),t)},f=function(e){var l,i={},t="",d=0;return p&&(t=":not(:last-child)"),v(e.children(t)).each(function(e,t){var n=!0;if(l=null!=v(t).attr("data-index")&&""!=v(t).attr("data-index")?v(t).attr("data-index"):d,d++,u.json.head.length){if(v(t).find(".editable-input:input").length&&"checkbox"==u.json.head[e].type){var a="";a=v(t).find(".editable-input:input").is(":checked")?u.json.head[e].checked:u.json.head[e].unchecked,i[l]=a,n=!1}"image"==u.json.head[e].type&&(i[l]=v(t).find("img").attr("src"),n=!1)}n&&(v(t).find(".editable-input:input").length?i[l]=v(t).find(".editable-input:input").val():i[l]=v(t).text(),0<u.json.head.length&&("checkbox"==u.json.head[e].type||"select"==u.json.head[e].type)&&(i[l]=v(t).attr("data-value"),n=!1))}),i},e=function(e){if("TABLE"!==e.prop("tagName"))return console.warm("Make sure that you're selecting <table> element!");if(void 0===u.button.edit.selector)return console.error('you missed selector property of button.edit object in options E.G "{\n\tbutton.edit:{\n\t\tshow:true/false\n\t}\n}"!');if(void 0===u.button.edit.active)return console.error('you missed show property of button.edit object in options E.G "{\n\tbutton.edit:{\n\t\tshow:true/false\n\t}\n}"!');var o="<thead>";o+="<tr>";var n,a=0;if(v.each(u.json.body[0],function(e,t){u.json.head.length&&null!=u.json.head[a].title?o+="<th>"+u.json.head[a].title+"</th>":o+="<th>"+e+"</th>",a++}),o+="</tr>",o+="</thead>",e.prepend(o),null!=u.json.body&&0<u.json.body.length){o="<tbody>";null==u.json.head&&(u.json.head={}),v.each(u.json.body,function(e,t){o+="<tr>";var d=0;v.each(t,function(e,t){var n=!0;if(0<u.json.head.length){if("color"==u.json.head[d].type&&(o+='<td data-index="'+e+'" data-value="'+t+'" style="background-color:'+t+'"></td>',n=!1),"select"==u.json.head[d].type&&null!=u.json.head[d].data){var a=u.json.head[d].data.filter(function(e){return e.value==t});if(!a.length)return console.error("make sure that your data is correct!");o+="<td data-index="+e+' data-value="'+a[0].value+'">'+a[0].label+"</td>",n=!1}if("image"==u.json.head[d].type&&(o+='<td data-index="'+e+'" ><img src="'+t+'"/></td>',n=!1),"checkbox"==u.json.head[d].type){var l=u.json.head[d].unchecked,i=t;if(null==u.json.head[d].checked||null==u.json.head[d].unchecked)return console.error("you missed checked/unchecked property for checkbox column!");"boolean"==typeof u.json.head[d].checked&&v.parseJSON(t),u.json.head[d].checked==t&&(l=u.json.head[d].checked),null!=u.json.head[d].label&&(i=u.json.head[d].label(l)),o+='<td data-index="'+e+'" data-value="'+l+'">'+i+"</td>",n=!1}}n&&(o+='<td data-index="'+e+'" >'+t+"</td>"),d++}),o+="</tr>"}),o+="</tbody>",u.beforeAppend(v(o)),e.append(o)}u.editable&&(v.each(e.children("tbody").children("tr"),function(e,t){var n="<td>";v.each(u.button,function(){this.active&&(n+='<span class="'+this.selector+'">'+this.text+"</span>",p=!0)}),p&&v(t).append(n+"</td>")}),p&&e.children("thead").children("tr:first-child").append('<th rowspan="'+e.children("thead").children("tr").length+'">'+u.button.title+"</th>")),n=e,u.editable&&(v(n).on("dblclick","tbody>tr",d),n.children("tbody").children("tr").addClass("editable-row-style")),u.button&&(u.button.edit.active&&n.on("click","."+u.button.edit.selector,d),u.button.delete.active&&n.on("click","."+u.button.delete.selector,r),v.each(u.button,function(e,t){if(!l.includes(e)){if(null==t.action||""==t.action||null==t.action)return console.error("you missed action function of button."+e+' object in options E.G "{\n\tbutton.costumButton:{\n\t\taction:"function($row){HELLO}" \n\t}\n}"!');if(null==t.selector)return console.error("you missed selector property of button."+e+' object in options E.G "{\n\tbutton.costumButton:{\n\t\tselector:".costumButton" \n\t}\n}"!');n.on("click","."+t.selector,function(e){t.action(f(v(e.currentTarget).parents("tr")),v(e.currentTarget).parents("tr"))})}})),u.sortable&&(n.children("thead").children("tr").children("th").click(function(){var e=v(this).parents("table").eq(0),t=e.find("tr:gt(0)").toArray().sort(i(v(this).index()));this.asc=!this.asc,this.asc||(t=t.reverse());for(var n=0;n<t.length;n++)e.append(t[n])}),n.children("thead").children("tr").children("th").addClass("sortable")),e.find("thead tr").length||console.warn("table without heads!"),e.find("tbody tr").length||console.warn("Empty table!")};this.each(function(){t.push(v(this)),e(v(this))});return{data:function(e){void 0===e&&(e=0);var n=[];return t[e].children("tbody").children("tr").each(function(e,t){n.push(f(v(t)))}),n}}}}($);