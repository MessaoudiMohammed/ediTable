!function(c){"use strict";c.fn.ediTable=function(a){var b=[],d=[],a=c.extend(!0,{editable:!0,json:{head:[],body:[]},button:{edit:{active:!1,text:"edit",selector:"edit"},delete:{active:!1,text:"delete",selector:"delete"},title:"Actions"},add:!1,keyboard:!0,beforeSave:function(){},afterSave:function(){},beforeEdit:function(){},afterEdit:function(){},beforeDelete:function(){},afterDelete:function(){}},a),e=["edit","delete","title"],f=function(b){a.editable&&(c(b).on("dblclick","tbody>tr",i),b.children("tbody").children("tr").addClass("editable-row-style")),a.button&&(a.button.edit.active&&c("."+a.button.edit.selector,b).bind("click",i),a.button.delete.active&&c("."+a.button.delete.selector,b).bind("click",o),c.each(a.button,function(a,d){if(!e.includes(a)){if(null==d.action||""==d.action||null==d.action)return console.error("you missed action function of button."+a+" object in options E.G \"{\n\tbutton.costumButton:{\n\t\taction:\"function($row){HELLO}\" \n\t}\n}\"!");if(null!=d.selector)c("."+d.selector,b).bind("click",function(a){d.action(p(c(a.currentTarget).parents("tr")),c(a.currentTarget).parents("tr"))});else return console.error("you missed selector property of button."+a+" object in options E.G \"{\n\tbutton.costumButton:{\n\t\tselector:\".costumButton\" \n\t}\n}\"!")}})),a.sortable&&(b.children("thead").children("tr").children("th").click(function(){var a=c(this).parents("table").eq(0),b=a.find("tr:gt(0)").toArray().sort(g(c(this).index()));this.asc=!this.asc,this.asc||(b=b.reverse());for(var d=0;d<b.length;d++)a.append(b[d])}),b.children("thead").children("tr").children("th").addClass("sortable"))},g=function(d){function e(a,b){return c(a).children("td").eq(b).text()}return function(f,a){var b=e(f,d),g=e(a,d);return c.isNumeric(b)&&c.isNumeric(g)?b-g:b.toString().localeCompare(g)}},h=!1,i=function(a){a.stopPropagation();var b=null;b="TR"===c(a.currentTarget).prop("tagName")?c(a.currentTarget):c(a.currentTarget).parents("tr"),0<b.find(".editable-input").length?k(b):m(b)},j=function(d){var e="";h&&(e=`:not(:last-child)`),c("td"+e,d).each(function(e,f){var g=!0;a.json.head!=null&&0<a.json.head.length&&(("select"==a.json.head[e].type||"checkbox"==a.json.head[e].type)&&(c(f).attr("data-value",b[d.prevAll().length][e].value),c(f).html(b[d.prevAll().length][e].label),g=!1),"color"==a.json.head[e].type&&(c(f).attr("data-value",b[d.prevAll().length][e].value),c(f).css("background-color",b[d.prevAll().length][e].value),c(f).html(""),g=!1),"image"==a.json.head[e].type&&(g=!1)),g&&c(f).html(b[d.prevAll().length][e].value)}),c.each(a.button,function(){this.active&&this.text!=null&&c("."+this.selector,d).html(this.text)})},k=function(d){a.beforeSave(b[d.prevAll().length],d);var e="",f=0,g="";h&&(e=`:not(:last-child)`);var i=[],j=[],k={};return d.children(`td${e}`).each(function(b,e){if(!1!=a.json.head[b].editable){if(0==c(".editable-input:input",c(e)).length)return;!1!=a.json.head[b].validation&&!1==c(".editable-input:input",c(e))[0].checkValidity()&&(j.push({input:c(".editable-input:input",c(e)),row:d.prevAll().length,column:b}),c(".editable-input:input",c(e)).addClass("error")),!1!=a.json.head[b].required&&"checkbox"!=a.json.head[b].type&&(""==c(".editable-input:input",c(e)).val()||null==c(".editable-input:input",c(e)).val()||null==c(".editable-input:input",c(e)).val())&&(i.push({input:c(".editable-input:input",c(e)),row:d.prevAll().length,column:b}),c(".editable-input:input",c(e)).addClass("error"))}}),0<i.length?void(a.requiredAction?a.requiredAction(i):alert(`Fields required.`)):0<j.length?void(a.invalidAction?a.invalidAction(j):alert(`Fields invalid.`)):void(d.children(`td${e}`).each(function(b,d){var e=!0,h=!1;if(g=null==c(d).attr("data-index")?f:c(d).attr("data-index"),0<a.json.head.length){if("color"==a.json.head[b].type&&(e=!1,!1==a.json.head[b].editable?h=!0:k[g]=c(".editable-input:input",c(d)).val(),c(d).attr("data-value",c(".editable-input:input",c(d)).val()),c(d).css({"background-color":c(".editable-input:input",c(d)).val()}),c(d).html("")),"checkbox"==a.json.head[b].type){if(null==a.json.head[b].checked||null==a.json.head[b].unchecked)return console.error("you missed checked/unchecked property of checkbox!");var i="",j=a.json.head[b].checked,l=a.json.head[b].unchecked;!c(".editable-input:input",c(d)).is(":checked")||(i=" checked"),c(".editable-input:input",c(d)).is(":checked")&&(l=a.json.head[b].checked),null!=a.json.head[b].label&&(j=a.json.head[b].label(l)),c(d).attr("data-value",l),c(d).html(j),e=!1,!1==a.json.head[b].editable?h=!0:k[g]=l}if(null!=a.json.head[b].data){var m=a.json.head[b].data.filter(function(b){return b.value==c(".editable-input:input",c(d)).val()});c(d).attr("data-value",m[0].value),c(d).html(m[0].label),e=!1,!1==a.json.head[b].editable?h=!0:k[g]=m[0].value}"image"==a.json.head[b].type&&(e=!1,!1==a.json.head[b].editable?h=!0:k[g]=c(d).find("img").attr("src"))}e&&(!1==a.json.head[b].editable?h=!0:k[g]=c(".editable-input:input",c(d)).val(),c(d).html(c(".editable-input:input",c(d)).val())),h&&(k[g]=c(d).text()),f++}),c.each(a.button,function(){this.active&&null!=this.text&&c("."+this.selector,d).html(this.text)}),a.afterSave(k,b[d.prevAll().length],d))},l=function(a){var b="",d=c(a.clone());h&&(b=`:not(:last-child)`),d.children(`td${b}`).html(""),d.children(`td${b}`).attr("data-value",""),d.children(`td${b}`).removeAttr("style"),console.log(c(a,a.parent())),c(a,a.parent()).is("tr:last-child")&&a.parent().append(d)},m=function(d){a.beforeEdit(p(d),d),!a.add||l(d);c.each(a.button,function(){this.active&&this.textActive!=null&&c("."+this.selector,d).html(this.textActive)});var e,f="",g=0;d.children(`td${""}`).each(function(i,j){if(!(h&&c(j).is(":last-child"))){if(e=null!=c(j).attr("data-index")&&""!=c(j).attr("data-index")?c(j).attr("data-index"):g,g++,null==a.json.head[i]&&(a.json.head[i]=[]),null==a.json.head[i].type&&(a.json.head[i].type="text"),null==b[d.prevAll().length]&&(b[d.prevAll().length]={}),b[d.prevAll().length][e]=c(j).text(),("select"==a.json.head[i].type||"color"==a.json.head[i].type||"checkbox"==a.json.head[i].type)&&(b[d.prevAll().length][e]=c(j).attr("data-value")),"image"==a.json.head[i].type)return b[d.prevAll().length][e]=c(j).children("img").attr("src");if(!1!=a.json.head[i].editable){f="<input style=\"width:"+c(j).width()+"px\" type=";var k="class=\"editable-input\"",l="value=\""+b[d.prevAll().length][e]+"\"";if(null!=a.json.head[i].classes&&(k="class=\""+a.json.head[i].classes+" editable-input\" "),"checkbox"==a.json.head[i].type){var m=c(j).attr("data-value");if(null==a.json.head[i].checked||null==a.json.head[i].unchecked)return console.error("you missed checked/unchecked property for checkbox column!");"boolean"==typeof a.json.head[i].checked&&(m=c.parseJSON(c(j).attr("data-value"))),f+=`"${a.json.head[i].type}" ${k} ${m==a.json.head[i].checked&&"checked"} />`}else if("select"==a.json.head[i].type)f=`<select ${k}><option value="">choose option</option>`,c.each(a.json.head[i].data,function(a,b){var d="";c(j).attr("data-value")==b.value&&(d="selected"),f+=`<option value="${b.value}" ${d} >${b.label}</option>`}),f+="</select>";else{var o="",p="";"number"==a.json.head[i].type&&(null!=a.json.head[i].min&&(o="min=\""+a.json.head[i].min+"\""),null!=a.json.head[i].max&&(p="max=\""+a.json.head[i].max+"\"")),f+=`"${a.json.head[i].type}" ${k} ${o} ${p} ${l} />`}c(j).html(f),c(".editable-input:input",c(j)).unbind("dblclick"),c(".editable-input:input",c(j)).bind("dblclick",function(a){a.stopPropagation()}),a.keyboard&&c(".editable-input:input",c(j)).on("keydown",function(a){n(a,d)}),!1!=a.json.head[i].validation&&c(":input",d.children(`:nth-child(${i+1})`)).blur(function(a){a.target.checkValidity()?c(a.target).removeClass("error"):c(a.target).addClass("error")})}}}),a.afterEdit(b[d.prevAll().length],d)},n=function(a,b){13===a.which?k(b):27===a.which&&j(b)},o=function(b){var d=c(b.currentTarget).parents("tr");a.beforeDelete(p(d),d),d.remove(),a.afterDelete(p(d),d)},p=function(b){var d,e={},f="",g=0;return h&&(f=":not(:last-child)"),c(b.children(f)).each(function(b,f){var h=!0;if(d=null!=c(f).attr("data-index")&&""!=c(f).attr("data-index")?c(f).attr("data-index"):g,g++,a.json.head.length){if(c(f).find(".editable-input:input").length&&"checkbox"==a.json.head[b].type){var i="";i=c(f).find(".editable-input:input").is(":checked")?a.json.head[b].checked:a.json.head[b].unchecked,e[d]=i,h=!1}"image"==a.json.head[b].type&&(e[d]=c(f).find("img").attr("src"),h=!1)}h&&(e[d]=c(f).find(".editable-input:input").length?c(f).find(".editable-input:input").val():c(f).text(),0<a.json.head.length&&("checkbox"==a.json.head[b].type||"select"==a.json.head[b].type)&&(e[d]=c(f).attr("data-value"),h=!1))}),e},q=function(b){if("TABLE"!==b.prop("tagName"))return console.warm("Make sure that you're selecting <table> element!");if(void 0===a.button.edit.selector)return console.error("you missed selector property of button.edit object in options E.G \"{\n\tbutton.edit:{\n\t\tshow:true/false\n\t}\n}\"!");if(void 0===a.button.edit.active)return console.error("you missed show property of button.edit object in options E.G \"{\n\tbutton.edit:{\n\t\tshow:true/false\n\t}\n}\"!");var d=`<thead>`;d+=`<tr>`;var e=0;if(c.each(a.json.body[0],function(b){d+=a.json.head.length&&null!=a.json.head[e].title?`<th>${a.json.head[e].title}</th>`:`<th>${b}</th>`,e++}),d+=`</tr>`,d+=`</thead>`,b.prepend(d),null!=a.json.body&&0<a.json.body.length){var d=`<tbody>`;null==a.json.head&&(a.json.head={}),c.each(a.json.body,function(b,e){d+=`<tr>`;var f=0;c.each(e,function(b,e){var g=!0;if(0<a.json.head.length){if("color"==a.json.head[f].type&&(d+=`<td data-index="${b}" data-value="${e}" style="background-color:${e}"></td>`,g=!1),"select"==a.json.head[f].type&&null!=a.json.head[f].data){var h=a.json.head[f].data.filter(function(b){return b.value==e});if(!h.length)return console.error("make sure that your data is correct!");d+=`<td data-index="${b}" data-value="${h[0].value}" >${h[0].label}</td>`,g=!1}if("image"==a.json.head[f].type&&(d+=`<td data-index="${b}" ><img src="${e}"/></td>`,g=!1),"checkbox"==a.json.head[f].type){var i=a.json.head[f].unchecked,j=e;if(null==a.json.head[f].checked||null==a.json.head[f].unchecked)return console.error("you missed checked/unchecked property for checkbox column!");"boolean"==typeof a.json.head[f].checked&&c.parseJSON(e),a.json.head[f].checked==e&&(i=a.json.head[f].checked),null!=a.json.head[f].label&&(j=a.json.head[f].label(i)),d+=`<td data-index="${b}" data-value="${i}" >${j}</td>`,g=!1}}g&&(d+=`<td data-index="${b}" >${e}</td>`),f++}),d+=`</tr>`}),d+=`</tbody>`,b.append(d)}return a.editable&&(c.each(b.children("tbody").children("tr"),function(b,d){var e="<td>";c.each(a.button,function(){this.active&&(e+=`<span class="${this.selector}" >${this.text}</span>`,h=!0)}),h&&c(d).append(e+"</td>")}),h&&b.children("thead").children("tr:first-child").append(`<th rowspan="${b.children("thead").children("tr").length}">${a.button.title}</th>`)),f(b),b.find("thead tr").length||console.warn("table without heads!"),void(b.find("tbody tr").length||console.warn("Empty table!"))};this.each(function(){d.push(c(this)),q(c(this))});return{data:function(a=0){var b=[];return d[a].children("tbody").children("tr").each(function(a,d){b.push(p(c(d)))}),b}}}}($);